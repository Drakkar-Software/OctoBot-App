name: OctoBot-App-CI
on: push

jobs:
  builds:
    name: Android - build
    runs-on: ubuntu-latest
    env:
      PYTHONUNBUFFERED: 1

    steps:
    - uses: actions/checkout@v2

    - name: Set up Python 3.8
      uses: actions/setup-python@v2
      with:
        python-version: '3.8.x'
        architecture: x64

    - name: Set numeric version
      id: settings
      run: echo "::set-output name=numeric_version::$(date +%Y%m%d%H%M%S)"

    - name: Build with Buildozer
      uses: ArtemSBulgakov/buildozer-action@v1
      id: buildozer
      with:
        command: buildozer android debug
        buildozer_version: stable
      env:
        BUILDOZER_APP_ANDROID_NUMERIC_VERSION: ${{ steps.settings.outputs.numeric_version }}

    - name: Upload artifacts
      uses: actions/upload-artifact@v2
      with:
        name: octobot.apk
        path: ${{ steps.buildozer.outputs.filename }}
